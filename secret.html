<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Locked Surprise</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;800&family=Great+Vibes&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }
        
        body {
            margin: 0;
            background: linear-gradient(-45deg, #2b1055, #7597de, #240b36, #1a0b2e);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            font-family: 'Outfit', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            flex-direction: column;
            perspective: 1000px; 
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- PARTICLES --- */
        .particles {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            overflow: hidden; pointer-events: none; z-index: -1;
        }
        .particle {
            position: absolute; bottom: -20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.4);
            animation: floatUp 10s infinite linear;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 0; }
            50% { opacity: 0.8; }
            100% { transform: translateY(-120vh) scale(0.5); opacity: 0; }
        }

        .instruction {
            color: #fff;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 0 0 15px rgba(255, 143, 171, 0.8);
            z-index: 10;
        }
        .instruction h3 { margin: 0; font-size: 2rem; letter-spacing: 2px; }
        .instruction p { font-weight: 300; font-size: 1.1rem; margin-top: 5px; opacity: 0.9; }

        /* --- THE CRATE --- */
        .crate-container {
            position: relative;
            width: 600px; 
            height: 400px;
            background: #5d4037;
            border-radius: 20px;
            
            /* THIS FIXES THE BAR STICKING OUT */
            overflow: hidden; 
            
            box-shadow: 
                0 0 0 4px #3e2723, 
                0 0 40px rgba(255, 143, 171, 0.3),
                inset 0 0 100px rgba(0,0,0,0.8);
            
            display: flex;
            justify-content: center;
            align-items: center;
            transform-style: preserve-3d;
            background-image: 
                url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 20.5V18H0v-2h20v5.1L6 4.8l1.4-1.4L20 16V0h2v16l12.6-12.6 1.4 1.4L23.4 18H40v2H23.4l12.6 12.6-1.4 1.4L22 21.4V40h-2V21.4L7.4 34 6 32.6 18.6 20H0v-2h18.6L6 5.4 7.4 4 20 16.6V0h2v16.6l12.6-12.6 1.4 1.4L23.4 18H40v2H23.4l12.6 12.6-1.4 1.4L22 21.4V40h-2V21.4L7.4 34 6 32.6 18.6 20z' fill='%23ffffff' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        /* --- THE REWARD CARD (FIXED SIZING) --- */
        .reward-card {
            position: absolute;
            width: 90%;
            height: 90%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            opacity: 0;
            transform: scale(0.8) translateZ(-50px);
            transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            text-decoration: none;
        }

        .reward-card::before {
            content: '';
            position: absolute;
            top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(to bottom right, transparent, transparent, rgba(255, 255, 255, 0.4), transparent, transparent);
            transform: rotate(45deg);
            animation: holoShine 3s infinite;
        }
        @keyframes holoShine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }
        
        .reward-card.visible {
            opacity: 1;
            transform: scale(1) translateZ(0);
            z-index: 50; 
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fff 100%);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        /* FONT SIZES ADJUSTED TO FIT */
        .yay-text {
            font-family: 'Great Vibes', cursive;
            color: #d63384;
            font-size: 4rem; /* Reduced from 5rem */
            margin: 0;
            line-height: 1;
            text-shadow: 2px 2px 0px rgba(255,255,255,0.6);
            z-index: 2;
        }
        
        .course-title {
            font-weight: 800;
            font-size: 2.5rem; /* Reduced from 3rem */
            background: -webkit-linear-gradient(#ff512f, #dd2476);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            line-height: 1;
            margin: 10px 0;
            z-index: 2;
        }

        .description {
            font-size: 1rem;
            color: #444;
            background: rgba(255,255,255,0.6);
            padding: 10px 15px;
            border-radius: 10px;
            z-index: 2;
            margin-bottom: 15px;
            max-width: 80%;
        }

        .tap-hint {
            background: #d63384;
            color: white;
            padding: 8px 25px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 10px 20px rgba(214, 51, 132, 0.4);
            animation: pulseBtn 2s infinite;
            z-index: 2;
        }
        @keyframes pulseBtn { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }


        /* --- THE METAL BARS --- */
        .bar {
            position: absolute;
            background: linear-gradient(to bottom, #cfd9df 0%, #a2b6df 100%);
            border: 1px solid #7f8c8d;
            box-shadow: inset 1px 1px 0 rgba(255,255,255,0.5), 0 10px 20px rgba(0,0,0,0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            transition: all 0.6s cubic-bezier(0.6, -0.28, 0.735, 0.045);
            z-index: 10;
        }
        .bar::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.4) 50%, transparent 60%);
            pointer-events: none;
        }
        
        /* Bar Dimensions updated */
        .bar-horizontal { width: 100%; height: 70px; left: 0; }
        .bar-vertical { width: 70px; height: 100%; top: 0; flex-direction: column; }
        
        /* Diagonal Bar - Centered and extra long (excess hidden by container) */
        .bar-diagonal { 
            width: 140%; 
            height: 60px; 
            top: 50%; 
            left: -20%; 
            transform: translateY(-50%) rotate(32deg); /* Adjusted angle for rectangle */
            justify-content: space-around; 
        }

        /* Positioning */
        #bar1 { top: 15%; z-index: 1; }  
        #bar2 { top: 70%; z-index: 1; }  
        #bar3 { left: 45%; z-index: 2; } 
        #bar4 { z-index: 3; box-shadow: 0 20px 30px rgba(0,0,0,0.6); }

        .bar.falling {
            transform: translateY(800px) rotate(45deg) !important;
            opacity: 0;
        }

        /* --- THE SCREWS --- */
        .screw {
            width: 45px; height: 45px;
            background: radial-gradient(circle at 30% 30%, #ffd700, #b8860b);
            border-radius: 50%;
            border: 2px solid #8b6508;
            cursor: pointer;
            position: relative;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            transition: transform 0.2s, filter 0.2s;
        }
        .screw::before, .screw::after {
            content: ''; position: absolute; top: 50%; left: 50%;
            width: 60%; height: 4px; background: #5c4305;
        }
        .screw::before { transform: translate(-50%, -50%) rotate(45deg); }
        .screw::after { transform: translate(-50%, -50%) rotate(-45deg); }
        
        .screw:hover { filter: brightness(1.2); transform: scale(1.1); }
        .screw:active { transform: scale(0.9); }
        
        .screw.removed { animation: unscrewAnim 0.4s forwards; pointer-events: none; }
        @keyframes unscrewAnim {
            0% { transform: rotate(0deg) scale(1); }
            100% { transform: rotate(-180deg) scale(0); opacity: 0; }
        }
    </style>
</head>
<body>

    <div class="particles" id="particles"></div>

    <div class="instruction">
        <h3>UNBOX YOUR GIFT üì¶</h3>
        <p>Unscrew the layers to unlock your surprise!</p>
    </div>

    <div class="crate-container" id="crate">
        
        <a href="https://www.udemy.com/course/belly-dance-for-beginners-technique-and-combinations/?couponCode=ACCAGE0923" target="_blank" class="reward-card" id="card">
            <h1 class="yay-text">Yayayyy!</h1>
            
            <div class="course-title">BELLY<br>DANCING<br>COURSE</div>
            
            <p class="description">
                Happy Birthday Kuhuji! ‚ù§Ô∏è<br>
                I know how great you can be at this<br>
                <strong>Let's give it a shot baby üëá</strong>
            </p>
            
            <div class="tap-hint">TAP TO OPEN üîó</div>
        </a>

        <div class="bar bar-horizontal" id="bar1">
            <div class="screw" onclick="unscrew(this, 'bar1')"></div>
            <div class="screw" onclick="unscrew(this, 'bar1')"></div>
        </div>

        <div class="bar bar-horizontal" id="bar2">
            <div class="screw" onclick="unscrew(this, 'bar2')"></div>
            <div class="screw" onclick="unscrew(this, 'bar2')"></div>
        </div>

        <div class="bar bar-vertical" id="bar3">
            <div class="screw" onclick="unscrew(this, 'bar3')"></div>
            <div class="screw" onclick="unscrew(this, 'bar3')"></div>
            <div class="screw" onclick="unscrew(this, 'bar3')"></div>
        </div>

        <div class="bar bar-diagonal" id="bar4">
            <div class="screw" onclick="unscrew(this, 'bar4')"></div>
            <div class="screw" onclick="unscrew(this, 'bar4')"></div>
            <div class="screw" onclick="unscrew(this, 'bar4')"></div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        // --- 1. PARTICLES ---
        const particleContainer = document.getElementById('particles');
        for(let i=0; i<20; i++) {
            const p = document.createElement('div');
            p.classList.add('particle');
            p.style.left = Math.random() * 100 + '%';
            p.style.width = Math.random() * 20 + 5 + 'px';
            p.style.height = p.style.width;
            p.style.animationDuration = Math.random() * 5 + 5 + 's';
            p.style.animationDelay = Math.random() * 5 + 's';
            particleContainer.appendChild(p);
        }

        // --- 2. LOGIC ---
        const bars = {
            'bar1': { layer: 1, removed: false },
            'bar2': { layer: 1, removed: false },
            'bar3': { layer: 2, removed: false },
            'bar4': { layer: 3, removed: false }
        };

        function unscrew(screwEl, barId) {
            screwEl.classList.add('removed');
            setTimeout(() => { checkBar(barId); }, 200);
        }

        function checkBar(barId) {
            const barEl = document.getElementById(barId);
            const remainingScrews = barEl.querySelectorAll('.screw:not(.removed)');

            if (remainingScrews.length === 0) {
                const myLayer = bars[barId].layer;
                let isBlocked = false;

                for (const [key, data] of Object.entries(bars)) {
                    if (data.layer > myLayer && !data.removed) {
                        isBlocked = true;
                    }
                }

                if (!isBlocked) {
                    dropBar(barId);
                } else {
                    barEl.style.transform = "translateY(-50%) rotate(32deg) scale(0.98)";
                    if(!barEl.classList.contains('bar-diagonal')) {
                         barEl.style.transform = "scale(0.98)";
                    }
                    setTimeout(() => {
                        if(barEl.classList.contains('bar-diagonal')) {
                            barEl.style.transform = "translateY(-50%) rotate(32deg) scale(1)";
                        } else {
                            barEl.style.transform = "scale(1)";
                        }
                    }, 100);
                }
            }
        }

        function dropBar(barId) {
            const barEl = document.getElementById(barId);
            barEl.classList.add('falling');
            bars[barId].removed = true;

            for (const [key, data] of Object.entries(bars)) {
                if (!data.removed && data.layer < bars[barId].layer) {
                    checkBar(key);
                }
            }

            if (Object.values(bars).every(b => b.removed)) {
                setTimeout(revealCard, 600);
            }
        }

        function revealCard() {
            document.getElementById('card').classList.add('visible');
            document.querySelector('.instruction h3').innerText = "SURPRISE! üéâ";
            document.querySelector('.instruction p').innerText = "Happy Birthday!";
            
            var duration = 3 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 100 };

            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }
                var particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random(), y: Math.random() - 0.2 } }));
            }, 250);
        }
    </script>
</body>
</html>